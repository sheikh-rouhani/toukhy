<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>الشيخ الطوخي - أعمال وخدمات روحانية موثوقة</title>
    <meta name="description" content="يقدم الشيخ الطوخي أعمال وخدمات روحانية مضمونة في جلب الحبيب، فك السحر، خواتم روحانية للرزق والقبول، وعلاج الأمراض الروحية. خبرة طويلة ونتائج بإذن الله.">
    <meta name="keywords" content="شيخ روحاني, الطوخي الروحاني, جلب الحبيب, فك السحر, رد المطلقة, خواتم روحانية, خاتم الرزق, خاتم القبول, علاج روحاني, تسهيل الزواج, أعمال روحانية, السعودية">
    <meta name="author" content="الشيخ الطوخي">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://sheikh-rouhani.github.io/toukhy/"> <meta property="og:title" content="الشيخ الطوخي - أعمال وخدمات روحانية موثوقة">
    <meta property="og:description" content="خدمات روحانية متخصصة في جلب الحبيب، فك السحر، خواتم روحانية للرزق والقبول والمحبة.">
    <meta property="og:image" content="img/og-twitter-imgs.jpg"> <meta property="og:url" content="https://sheikh-rouhani.github.io/toukhy/"> <meta property="og:type" content="website">
    <meta property="og:locale" content="ar_SA">

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="الشيخ الطوخي - أعمال وخدمات روحانية موثوقة">
    <meta name="twitter:description" content="خدمات روحانية متخصصة في جلب الحبيب، فك السحر، خواتم روحانية للرزق والقبول والمحبة.">
    <meta name="twitter:image" content="img/og-twitter-imgs.jpg"> <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&family=Marhey:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <style>
        :root {
            --primary-color: #FFD700; /* ذهبي */
            --secondary-color: #000000; /* أسود */
            --text-light-primary: #1f2937; 
            --text-dark-primary: #f3f4f6;  
            --bg-light-mode: #ffffff;
            --bg-dark-mode: #111827;
            --bg-dark-secondary: #1f2937;
        }

        body {
            font-family: 'Cairo', sans-serif;
            color: var(--text-light-primary);
            background-color: var(--bg-light-mode);
            transition: background-color 0.3s, color 0.3s;
        }

        .dark body {
            color: var(--text-dark-primary);
            background-color: var(--bg-dark-mode);
        }
        
        .dark .bg-white { background-color: var(--bg-dark-secondary) !important; }
        .dark .bg-gray-50 { background-color: var(--bg-dark-mode) !important; }
        .dark .bg-gray-100 { background-color: var(--bg-dark-secondary) !important; }
        
        .dark .text-gray-900 { color: var(--text-dark-primary) !important; }
        .dark .text-gray-800 { color: #e5e7eb !important; } 
        .dark .text-gray-700 { color: #d1d5db !important; } 
        .dark .text-gray-600 { color: #9ca3af !important; }
        .dark .text-gray-500 { color: #6b7280 !important; }

        .dark .border-gray-200 { border-color: #374151 !important; }
        .dark .border-gray-300 { border-color: #4b5563 !important; }
        
        .dark .shadow-lg { box-shadow: 0 10px 15px -3px rgba(255, 215, 0, 0.1), 0 4px 6px -2px rgba(255, 215, 0, 0.05); }
        
        .dark input, .dark textarea, .dark select {
            background-color: #374151 !important;
            color: var(--text-dark-primary) !important;
            border-color: #4b5563 !important;
        }
        .dark input::placeholder, .dark textarea::placeholder {
            color: #9ca3af !important;
        }

        .font-marhey {
            font-family: 'Marhey', sans-serif;
        }

        .hero-text-container::after {
            content: '|';
            animation: blink 1s infinite;
            color: var(--primary-color);
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0; }
        }

        .hero-section {
            background-image: linear-gradient(to bottom, rgba(0, 0, 0, 0.6), rgba(0, 0, 0, 0.9)), url('img/hero_section_bg.jpg'); /* خلفية تناسب الطابع الروحاني */
            background-size: cover;
            background-position: center;
            position: relative;
            min-height: 60vh; 
        }
        .hero-section::after { 
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 100px; 
            background: linear-gradient(to bottom, transparent, var(--bg-light-mode));
            z-index: 1;
        }
        .dark .hero-section::after {
            background: linear-gradient(to bottom, transparent, var(--bg-dark-mode));
        }

        #sidebar {
            transition: transform 0.3s ease-in-out;
        }
        #sidebarOverlay {
            transition: opacity 0.3s ease-in-out;
        }

        .product-box {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .product-box:hover {
            transform: translateY(-5px);
        }

        .rating-star {
            cursor: pointer;
            color: #d1d5db; 
            transition: color 0.2s;
        }
        .rating-star.selected, .rating-star:hover, .dark .rating-star:hover {
            color: var(--primary-color); 
        }
        .dark .rating-star {
            color: #4b5563; 
        }
        .dark .rating-star.selected {
            color: var(--primary-color);
        }
        
        .separator-line {
            height: 1px;
            background: linear-gradient(to right, transparent, var(--primary-color), transparent);
            margin: 2rem auto;
            width: 80%;
        }
        .dark .swal2-popup {
            background-color: var(--bg-dark-secondary) !important;
            color: var(--text-dark-primary) !important;
        }
        .dark .swal2-title {
            color: var(--text-dark-primary) !important;
        }
        .dark .swal2-html-container {
            color: #d1d5db !important;
        }
        .dark .swal2-loader {
            border-color: var(--primary-color) transparent var(--primary-color) transparent !important;
        }
        .dark .swal2-timer-progress-bar {
            background: var(--primary-color) !important;
        }

    </style>
</head>
<body class="bg-white text-gray-800">

    <div id="sidebarOverlay" class="fixed inset-0 bg-black bg-opacity-50 z-40 hidden md:hidden"></div>

    <aside id="sidebar" class="sidebar fixed top-0 right-0 h-full w-72 bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-200 p-6 transform translate-x-full shadow-lg z-50">
        <button id="closeSidebarBtn" class="absolute top-4 left-4 text-3xl text-gray-600 dark:text-gray-400 hover:text-yellow-500 dark:hover:text-yellow-400 md:hidden">&times;</button>
        <div class="flex flex-col items-center mb-8">
            <img src="img/logo.png" alt="شعار الشيخ الطوخي" class="w-24 h-24 rounded-full border-2 border-yellow-400 mb-4">
            <h2 class="font-marhey text-2xl text-yellow-500 dark:text-yellow-400">الشيخ الطوخي</h2>
        </div>
        <nav class="space-y-4 text-center">
            <a href="#products" class="block py-2 px-4 rounded hover:bg-yellow-400 hover:text-black dark:hover:bg-yellow-500 dark:hover:text-black transition-colors">خدماتنا الروحانية</a>
            <a href="#about" class="block py-2 px-4 rounded hover:bg-yellow-400 hover:text-black dark:hover:bg-yellow-500 dark:hover:text-black transition-colors">عن الشيخ الطوخي</a>
            <a href="#comments-section" class="block py-2 px-4 rounded hover:bg-yellow-400 hover:text-black dark:hover:bg-yellow-500 dark:hover:text-black transition-colors">قسم التعليقات</a>
            <a href="#" class="whatsapp-link-global flex items-center justify-center py-2 px-4 rounded bg-green-500 hover:bg-green-600 text-white transition-colors" target="_blank">
                <i class="fab fa-whatsapp mr-2"></i> تواصل واتساب
            </a>
        </nav>
        <div class="mt-auto pt-8 text-center">
            <button id="sidebarThemeToggle" class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 focus:outline-none">
                <i class="fas fa-sun text-yellow-500"></i> 
            </button>
        </div>
    </aside>

    <div id="mainContent" class="transition-all duration-300 ease-in-out pb-16">
        <header class="sticky top-0 bg-white dark:bg-gray-800 shadow-md z-30">
            <div class="container mx-auto px-4 py-3 flex justify-between items-center">
                <button id="menuToggle" class="text-2xl text-gray-700 dark:text-gray-200 md:hidden">
                    <i class="fas fa-bars"></i>
                </button>
                <div class="flex-grow text-center md:flex-grow-0 md:absolute md:left-1/2 md:-translate-x-1/2">
                     <img src="img/logo.png" alt="شعار الشيخ الطوخي المصغر" class="w-12 h-12 inline-block rounded-full">
                </div>
                <button id="headerThemeToggle" class="p-2 rounded-full text-gray-700 dark:text-gray-200 hover:bg-gray-200 dark:hover:bg-gray-700 focus:outline-none">
                    <i class="fas fa-sun text-yellow-500"></i> 
                </button>
            </div>
        </header>

        <section class="hero-section flex items-center justify-center text-white relative -mt-[68px] pt-[68px]">
            <div class="text-center z-10 relative p-4">
                <h1 id="dynamicText" class="font-marhey text-4xl sm:text-5xl md:text-6xl lg:text-7xl mb-6 hero-text-container" style="min-height: 80px;"></h1>
                <p class="text-lg md:text-xl text-gray-200 dark:text-gray-300 mb-8">أسرار العلوم الروحانية بين يديك لحياة أفضل بإذن الله</p>
                <a href="#products" class="bg-yellow-500 hover:bg-yellow-600 text-black font-bold py-3 px-8 rounded-lg text-lg transition-colors shadow-lg">
                    اكتشف خدماتنا
                </a>
            </div>
        </section>

        <section id="about" class="py-16 container mx-auto px-4">
            <h2 class="font-marhey text-3xl text-center mb-8 text-gray-900 dark:text-yellow-400">عن الشيخ الطوخي</h2>
            <p class="text-center text-lg text-gray-700 dark:text-gray-300 max-w-2xl mx-auto">
                بعون الله وتوفيقه، يسخر الشيخ الطوخي خبرته الطويلة في العلوم الروحانية لمساعدتكم في تجاوز الصعاب وتحقيق السعادة. نقدم استشارات وأعمال روحانية موثوقة في جلب الحبيب، فك جميع أنواع السحر، رد المطلقة، تسهيل أمور الزواج، وجلب الرزق والبركة. نعمل بسرية تامة ونتائجنا تتحدث عنا بإذن الله. هدفنا هو رضاكم وراحتكم.
            </p>
        </section>

        <section id="products" class="py-12">
            <div class="container mx-auto px-4">
                <h2 class="font-marhey text-3xl text-center mb-12 text-gray-900 dark:text-yellow-400">أبرز الخدمات والمنتجات</h2>
                <div id="productGrid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8">
                    </div>
            </div>
        </section>

        <section id="comments-section" class="py-16 bg-gray-50 dark:bg-gray-900">
            <div class="container mx-auto px-4">
                
                <div class="mb-12 p-6 bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-2xl mx-auto">
                    <h3 class="font-marhey text-2xl mb-6 text-gray-900 dark:text-yellow-500">إضافة تعليق</h3>
                    <form id="commentForm">
                        <input type="hidden" id="replyToCommentId" value="">
                        <div class="mb-4">
                            <label for="commentName" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">الاسم (أو كنية) والبلد<span class="text-red-500">*</span></label>
                            <input type="text" id="commentName" name="commentName" required class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-yellow-500 focus:border-yellow-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                        </div>
                        <div class="mb-4">
                            <label for="commentEmail" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">البريد الإلكتروني (اختياري، لن يظهر)</label>
                            <input type="email" id="commentEmail" name="commentEmail" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-yellow-500 focus:border-yellow-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                        </div>
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">تقييم الخدمة <span class="text-red-500">*</span></label>
                            <div id="commentRating" class="flex">
                                <i class="fas fa-star rating-star text-2xl" data-value="1"></i>
                                <i class="fas fa-star rating-star text-2xl" data-value="2"></i>
                                <i class="fas fa-star rating-star text-2xl" data-value="3"></i>
                                <i class="fas fa-star rating-star text-2xl" data-value="4"></i>
                                <i class="fas fa-star rating-star text-2xl" data-value="5"></i>
                            </div>
                            <input type="hidden" id="ratingValue" name="ratingValue" required>
                        </div>
                        <div class="mb-6">
                            <label for="commentText" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">تعليقك <span class="text-red-500">*</span></label>
                            <textarea id="commentText" name="commentText" rows="4" required class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-yellow-500 focus:border-yellow-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white"></textarea>
                        </div>
                        <button type="submit" class="w-full bg-yellow-500 hover:bg-yellow-600 text-black font-bold py-3 px-4 rounded-md transition-colors shadow-md flex items-center justify-center">
                            <i class="fas fa-paper-plane mr-2"></i> إرسال التعليق
                        </button>
                    </form>
                </div>

              <h2 class="font-marhey text-3xl text-center mb-12 text-gray-900 dark:text-yellow-400">التعليقات</h2>
                <div id="commentsList" class="space-y-8">
                    </div>
            </div>
        </section>

        <footer class="bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300 py-12">
            <div class="container mx-auto px-4 text-center">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-8">
                    <div>
                        <h3 class="font-marhey text-xl text-yellow-500 dark:text-yellow-400 mb-4">روابط مهمة</h3>
                        <nav class="space-y-2">
                            <a href="#products" class="block hover:text-yellow-600 dark:hover:text-yellow-300 transition-colors">خدمات ومنتجات</a>
                            <a href="#about" class="block hover:text-yellow-600 dark:hover:text-yellow-300 transition-colors">عن الشيخ الطوخي</a>
                            <a href="#comments-section" class="block hover:text-yellow-600 dark:hover:text-yellow-300 transition-colors">التعليقات</a>
                        </nav>
                    </div>
                    <div>
                        <h3 class="font-marhey text-xl text-yellow-500 dark:text-yellow-400 mb-4">للتواصل المباشر</h3>
                        <a href="#" class="whatsapp-link-global inline-flex items-center justify-center py-2 px-4 rounded bg-green-500 hover:bg-green-600 text-white transition-colors" target="_blank">
                            <i class="fab fa-whatsapp mr-2"></i> واتساب الشيخ الطوخي
                        </a>
                        <p class="mt-2">استشارات وحجز الأعمال الروحانية</p>
                    </div>
                    <div>
                        <h3 class="font-marhey text-xl text-yellow-500 dark:text-yellow-400 mb-4">أدوات الصفحة</h3>
                        <button id="goToTop" class="block w-full text-left py-2 hover:text-yellow-600 dark:hover:text-yellow-300 transition-colors"><i class="fas fa-arrow-up mr-2"></i> العودة للأعلى</button>
                        <button id="goToComments" class="block w-full text-left py-2 hover:text-yellow-600 dark:hover:text-yellow-300 transition-colors"><i class="fas fa-comments mr-2"></i> قسم التعليقات</button>
                    </div>
                </div>
                <div class="border-t border-gray-300 dark:border-gray-700 pt-8">
                    <p>&copy; <span id="currentYear"></span> الشيخ الطوخي للأعمال الروحانية. جميع الحقوق محفوظة.</p>
                    <p class="text-sm">برمجة وتصميم 2009 - 2025</p>
                </div>
            </div>
        </footer>
    </div> 

    <a href="#" class="whatsapp-link-global fixed bottom-12 right-8 md:bottom-16 md:right-10 bg-green-500 text-white w-14 h-14 rounded-full flex items-center justify-center shadow-lg hover:bg-green-600 transition-colors z-50" target="_blank" aria-label="تواصل عبر واتساب مع الشيخ الطوخي">
        <i class="fab fa-whatsapp text-3xl"></i>
    </a>

    <script>
        // --- Global WhatsApp Configuration ---
        const globalWhatsappNumber = '212684574232';
        const globalWhatsappMessage = '. . . السلام عليكم . . .'; 
        const encodedGlobalWhatsappMessage = encodeURIComponent(globalWhatsappMessage);
        const fullGlobalWhatsappLink = `https://wa.me/${globalWhatsappNumber}?text=${encodedGlobalWhatsappMessage}`;

        function updateAllWhatsappLinks() {
            document.querySelectorAll('.whatsapp-link-global').forEach(linkElement => {
                linkElement.href = fullGlobalWhatsappLink;
            });
        }

        // --- LocalStorage Helper ---
        function getFromLocalStorage(key, defaultValue = null) {
            try {
                const item = localStorage.getItem(key);
                return item ? JSON.parse(item) : defaultValue;
            } catch (error) {
                console.error(`Error reading from localStorage key "${key}":`, error);
                return defaultValue;
            }
        }

        function saveToLocalStorage(key, value) {
            try {
                localStorage.setItem(key, JSON.stringify(value));
            } catch (error) {
                console.error(`Error saving to localStorage key "${key}":`, error);
            }
        }

        // --- Theme Toggle ---
        const themeToggleButtons = [document.getElementById('headerThemeToggle'), document.getElementById('sidebarThemeToggle')];
        const htmlElement = document.documentElement;

        function updateThemeIcons(isDark) {
            themeToggleButtons.forEach(button => {
                if (button) {
                    button.innerHTML = isDark ? '<i class="fas fa-moon text-indigo-400"></i>' : '<i class="fas fa-sun text-yellow-500"></i>';
                }
            });
        }
        
        function applyTheme(theme) {
            if (theme === 'dark') {
                htmlElement.classList.add('dark');
                updateThemeIcons(true);
                saveToLocalStorage('altoukhy_theme', 'dark');
            } else {
                htmlElement.classList.remove('dark');
                updateThemeIcons(false);
                saveToLocalStorage('altoukhy_theme', 'light');
            }
        }

        themeToggleButtons.forEach(button => {
            if (button) {
                button.addEventListener('click', () => {
                    const isDark = htmlElement.classList.contains('dark');
                    applyTheme(isDark ? 'light' : 'dark');
                });
            }
        });
        
        const savedTheme = getFromLocalStorage('altoukhy_theme') || (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
        applyTheme(savedTheme);

        // --- Sidebar Toggle ---
        const menuToggle = document.getElementById('menuToggle');
        const sidebar = document.getElementById('sidebar');
        const closeSidebarBtn = document.getElementById('closeSidebarBtn');
        const sidebarOverlay = document.getElementById('sidebarOverlay');

        function openSidebar() {
            sidebar.classList.remove('translate-x-full');
            sidebarOverlay.classList.remove('hidden');
            if (window.innerWidth < 768) { document.body.style.overflow = 'hidden'; }
        }

        function closeSidebar() {
            sidebar.classList.add('translate-x-full');
            sidebarOverlay.classList.add('hidden');
            if (window.innerWidth < 768) { document.body.style.overflow = ''; }
        }

        if (menuToggle) menuToggle.addEventListener('click', openSidebar);
        if (closeSidebarBtn) closeSidebarBtn.addEventListener('click', closeSidebar);
        if (sidebarOverlay) sidebarOverlay.addEventListener('click', closeSidebar);
        
        sidebar.querySelectorAll('a').forEach(link => {
            link.addEventListener('click', () => { if (window.innerWidth < 768) { closeSidebar(); } });
        });

        // --- Dynamic Hero Text ---
        const dynamicTextElement = document.getElementById('dynamicText');
        const textsToAnimate = [
            "جلب الحبيب ورد المطلقة..", "فك السحر وعلاج المس..", "خواتم روحانية للرزق والقبول..", "تسهيل الزواج وحل المشاكل..", "استشارات روحانية خاصة.."
        ];
        let textIndex = 0; let charIndex = 0; let isDeleting = false;
        const typingSpeed = 120; const deletingSpeed = 70; const delayBetweenTexts = 2000; 

        function typeText() {
            if (!dynamicTextElement) return;
            const currentText = textsToAnimate[textIndex];
            if (isDeleting) {
                dynamicTextElement.textContent = currentText.substring(0, charIndex - 1);
                charIndex--;
            } else {
                dynamicTextElement.textContent = currentText.substring(0, charIndex + 1);
                charIndex++;
            }

            if (!isDeleting && charIndex === currentText.length) {
                isDeleting = true; setTimeout(typeText, delayBetweenTexts);
            } else if (isDeleting && charIndex === 0) {
                isDeleting = false; textIndex = (textIndex + 1) % textsToAnimate.length; setTimeout(typeText, typingSpeed);
            } else {
                setTimeout(typeText, isDeleting ? deletingSpeed : typingSpeed);
            }
        }
        
        // --- Product/Service Interactions ---
        const productGrid = document.getElementById('productGrid');
        const initialProductsData = [
            { id: 'service1', name: 'جلب الحبيب ورد المطلقة', image: 'img/jalb_alhabib.jpg', ctaText: 'اطلب العمل الآن' },
            { id: 'service2', name: 'فك السحر بأنواعه', image: 'img/fakk_alsihr.jpg', ctaText: 'تخلص من السحر' },
            { id: 'service3', name: 'خاتم روحاني للرزق والبركة', image: 'img/khatam_rizq.jpg', ctaText: 'اطلب خاتمك المبارك' },
            { id: 'service4', name: 'تسهيل زواج العوانس', image: 'img/tashil_zawaj.jpg', ctaText: 'استشر الشيخ' },
            { id: 'service5', name: 'علاج المس والعين والحسد', image: 'img/ilaj_mass_ayn.jpg', ctaText: 'اطلب العلاج الآن' },
            { id: 'service6', name: 'خاتم القبول والهيبة', image: 'img/khatam_qabul.jpg', ctaText: 'اطلب خاتم الهيبة' },
            { id: 'service7', name: 'أعمال روحانية للطاعة العمياء', image: 'img/taah_amya.jpg', ctaText: 'استفسر عن العمل' },
            { id: 'service8', name: 'كشف روحاني دقيق', image: 'img/kashf_rohani.jpg', ctaText: 'اطلب كشفك الآن' },
        ];
        let productInteractions = getFromLocalStorage('altoukhy_product_interactions_spiritual', {});

        function initializeProductInteractions() {
            let updated = false;
            initialProductsData.forEach(product => {
                if (!productInteractions[product.id]) {
                    productInteractions[product.id] = {
                        likes: Math.floor(Math.random() * (980 - 295 + 1)) + 295,
                        hearts: Math.floor(Math.random() * (980 - 295 + 1)) + 295,
                        userLiked: false, userHearted: false
                    };
                    updated = true;
                }
            });
            if (updated) {
                saveToLocalStorage('altoukhy_product_interactions_spiritual', productInteractions);
            }
        }
        
        function renderProducts() {
            if (!productGrid) return;
            productGrid.innerHTML = '';
            initialProductsData.forEach((product, index) => {
                const productData = productInteractions[product.id] || { likes: 0, hearts: 0, userLiked: false, userHearted: false };
                const box = document.createElement('div');
                box.className = 'product-box bg-white dark:bg-gray-800 rounded-lg shadow-lg overflow-hidden p-6 flex flex-col'; // Added flex flex-col
                box.innerHTML = `
                    <img src="${product.image}" alt="${product.name}" class="w-full h-48 object-cover rounded-md mb-4" onerror="this.onerror=null;this.src='https://placehold.co/400x300/CCCCCC/FFFFFF?text=Image+Not+Found';">
                    <h3 class="font-marhey text-xl mb-2 text-gray-900 dark:text-yellow-400">${product.name}</h3>
                    <div class="mt-auto"> <a href="#" class="whatsapp-link-global inline-block w-full text-center bg-green-500 hover:bg-green-600 text-white py-2 px-3 rounded-md text-sm mb-3 transition-colors" target="_blank">
                            <i class="fab fa-whatsapp mr-1"></i> ${product.ctaText}
                        </a>
                        <div class="flex justify-between items-center text-gray-600 dark:text-gray-400">
                            <button class="interaction-btn p-1" data-product-id="${product.id}" data-type="like" aria-label="إعجاب بالخدمة">
                                <i class="fas fa-thumbs-up ${productData.userLiked ? 'text-yellow-500' : ''}"></i> <span class="like-count">${productData.likes}</span>
                            </button>
                            <button class="interaction-btn p-1" data-product-id="${product.id}" data-type="heart" aria-label="أحببت الخدمة">
                                <i class="fas fa-heart ${productData.userHearted ? 'text-red-500' : ''}"></i> <span class="heart-count">${productData.hearts}</span>
                            </button>
                        </div>
                    </div>`;
                productGrid.appendChild(box);
                if (index < initialProductsData.length - 1 && window.innerWidth < 640) { 
                     const hr = document.createElement('div');
                     hr.className = 'separator-line';
                     productGrid.appendChild(hr);
                }
            });
            document.querySelectorAll('.interaction-btn').forEach(button => button.addEventListener('click', handleProductInteraction));
            updateAllWhatsappLinks(); 
        }
        
        function handleProductInteraction(event) {
            const button = event.currentTarget; const productId = button.dataset.productId; const type = button.dataset.type;
            const productData = productInteractions[productId];
            if (!productData) return; 

            if (type === 'like') {
                productData.userLiked ? productData.likes-- : productData.likes++;
                productData.userLiked = !productData.userLiked;
                button.querySelector('i').classList.toggle('text-yellow-500', productData.userLiked);
                button.querySelector('.like-count').textContent = productData.likes;
            } else if (type === 'heart') {
                productData.userHearted ? productData.hearts-- : productData.hearts++;
                productData.userHearted = !productData.userHearted;
                button.querySelector('i').classList.toggle('text-red-500', productData.userHearted);
                button.querySelector('.heart-count').textContent = productData.hearts;
            }
            saveToLocalStorage('altoukhy_product_interactions_spiritual', productInteractions);
        }

        // --- Comments System ---
        const commentForm = document.getElementById('commentForm');
        const commentsList = document.getElementById('commentsList');
        const ratingStarsContainer = document.getElementById('commentRating');
        const ratingValueInput = document.getElementById('ratingValue');
        const replyToCommentIdInput = document.getElementById('replyToCommentId');
        let comments = getFromLocalStorage('altoukhy_comments_spiritual', []);
        
        function initializeDefaultComments() {
            if (getFromLocalStorage('altoukhy_comments_initialized_spiritual') && comments.length > 0) {
                return; 
            }
            
            if (comments.length === 0 || !getFromLocalStorage('altoukhy_comments_initialized_spiritual')) {
                const today = new Date();
                const d = (days) => new Date(today.getFullYear(), today.getMonth(), today.getDate() - days).toISOString();
                
                comments = [
                    { id: 'commentDefS1', name: 'أم فهد - الرياض', email: '', rating: 5, text: 'والله يا شيخ طوخي ما قصرت، زوجي رجع لي مثل أول وأحسن بعد ما سويت لي عمل رد المطلقة. الله يجزاك خير.', likes: Math.floor(Math.random()*(80-15+1))+15, userLiked: false, replies: [], timestamp: d(20) },
                    { id: 'commentDefS2', name: 'سلطان أبو قحط', email: '', rating: 5, text: 'كنت أعاني من سحر وقف حالي سنين، وبفضل الله ثم بفضل الشيخ الطوخي انفك السحر ورجعت حياتي طبيعية. أنصحكم فيه.', likes: Math.floor(Math.random()*(80-15+1))+15, userLiked: false, replies: [], timestamp: d(10) },
                    { id: 'commentDefS3', name: 'نورة', email: '', rating: 4, text: 'خاتم الرزق اللي أخذته من الشيخ ما شاء الله تبارك الله، فتح لي أبواب خير كثيرة. الله يبارك فيك يا شيخ.', likes: Math.floor(Math.random()*(80-15+1))+15, userLiked: false, replies: [], timestamp: d(5) },
                    { id: 'commentDefS4', name: 'أبو محمد', email: '', rating: 5, text: 'بنتي كانت متعسرة في زواجها، والشيخ سوى لها عمل تسهيل زواج والحمد لله انخطبت. شيخ ثقة.', likes: Math.floor(Math.random() * (80 - 15 + 1)) + 15, userLiked: false, replies: [], timestamp: d(30) },
                    { id: 'commentDefS5', name: 'فاطمة', email: '', rating: 5, text: 'جربت الكشف الروحاني عند الشيخ الطوخي، كلامه كله صح ووصف لي العلاج المناسب لحالتي. الله يكتب أجرك.', likes: Math.floor(Math.random() * (80 - 15 + 1)) + 15, userLiked: false, replies: [], timestamp: d(3) },
                    { id: 'commentDefS6', name: 'خالد أبو فيصل', email: '', rating: 4, text: 'طلبت خاتم القبول والهيبة، وحسيت بفرق كبير في تعامل الناس معاي. شغلكم مضبوط يا شيخ.', likes: Math.floor(Math.random() * (80 - 15 + 1)) + 15, userLiked: false, replies: [], timestamp: d(12) },
                    { id: 'commentDefS7', name: 'مريم حمدان', email: '', rating: 5, text: 'كان زوجي متغير علي ويهملني، عمل جلب الحبيب من الشيخ رجعه لي أحسن من أول. ما أعرف كيف أشكره.', likes: Math.floor(Math.random()*(80-15+1))+15, userLiked: false, replies: [], timestamp: d(45) },
                    { id: 'commentDefS8', name: 'عبدالله ابن محمد', email: '', rating: 5, text: 'الشيخ الطوخي معروف بأمانته وصدقه في الأعمال الروحانية. الله يكثر من أمثالك.', likes: Math.floor(Math.random()*(80-15+1))+15, userLiked: false, replies: [], timestamp: d(8) },
                    { id: 'commentDefS9', name: 'نوفة', email: '', rating: 4, text: 'كنت دايم أحس بضيق وتعب بدون سبب، وبعد العلاج الروحاني عند الشيخ الحمد لله تحسنت كثير.', likes: Math.floor(Math.random()*(80-15+1))+15, userLiked: false, replies: [], timestamp: d(25) },
                    { id: 'commentDefS10', name: 'أحمد - جازان', email: '', rating: 5, text: 'طلبت عمل للطاعة، وبصراحة النتيجة كانت أسرع مما توقعت. الشيخ الطوخي شغله مضمون.', likes: Math.floor(Math.random() * (80 - 15 + 1)) + 15, userLiked: false, replies: [], timestamp: d(2) },
                    { id: 'commentDefS11', name: 'أم تركي / نجران', email: '', rating: 5, text: 'الله يبيض وجهك يا شيخ، ولدي كان رافض الزواج وبعد عملك الحمد لله وافق ولقينا له بنت الحلال.', likes: Math.floor(Math.random() * (80 - 15 + 1)) + 15, userLiked: false, replies: [], timestamp: d(18) },
                    { id: 'commentDefS12', name: 'يوسف الدوسري', email: '', rating: 4, text: 'التعامل مع الشيخ الطوخي مريح جداً، يسمع لك ويفهم مشكلتك ويقدم لك الحل المناسب. أنصح فيه.', likes: Math.floor(Math.random() * (80 - 15 + 1)) + 15, userLiked: false, replies: [], timestamp: d(40) }
                ];
                saveToLocalStorage('altoukhy_comments_spiritual', comments);
                saveToLocalStorage('altoukhy_comments_initialized_spiritual', true); 
            }
        }

        if (ratingStarsContainer) {
            const stars = ratingStarsContainer.querySelectorAll('.rating-star');
            stars.forEach(star => {
                star.addEventListener('click', () => {
                    const value = parseInt(star.dataset.value);
                    ratingValueInput.value = value;
                    stars.forEach((s, i) => s.classList.toggle('selected', i < value));
                });
                star.addEventListener('mouseover', () => {
                    const value = parseInt(star.dataset.value);
                    stars.forEach((s, i) => s.style.color = i < value ? 'var(--primary-color)' : (htmlElement.classList.contains('dark') ? '#4b5563' : '#d1d5db'));
                });
                star.addEventListener('mouseout', () => {
                    const selectedValue = parseInt(ratingValueInput.value) || 0;
                     stars.forEach((s, i) => {
                        s.style.color = i < selectedValue ? 'var(--primary-color)' : (htmlElement.classList.contains('dark') ? '#4b5563' : '#d1d5db');
                        s.classList.toggle('selected', i < selectedValue);
                    });
                });
            });
        }
        
        function renderComments() {
            if (!commentsList) return;
            commentsList.innerHTML = '';
            // Ensure comments is an array before sorting
            const commentsToRender = Array.isArray(comments) ? comments : [];
            commentsToRender.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp)); 

            commentsToRender.forEach(comment => {
                commentsList.appendChild(createCommentElement(comment));
                if (comment.replies && comment.replies.length > 0) {
                    const repliesContainer = document.createElement('div');
                    repliesContainer.className = 'mr-6 md:mr-8 mt-4 space-y-4 border-r-2 border-yellow-400 dark:border-yellow-500 pr-4';
                    comment.replies.sort((a, b) => new Date(a.timestamp) - new Date(b.timestamp)); 
                    comment.replies.forEach(reply => repliesContainer.appendChild(createCommentElement(reply, true)));
                    commentsList.appendChild(repliesContainer);
                }
            });
            document.querySelectorAll('.comment-like-btn').forEach(button => button.addEventListener('click', handleCommentLike));
            document.querySelectorAll('.comment-reply-btn').forEach(button => button.addEventListener('click', handleCommentReplySetup));
        }

        function createCommentElement(comment, isReply = false) {
            const commentDiv = document.createElement('div');
            commentDiv.className = `p-4 rounded-lg shadow ${isReply ? 'bg-gray-100 dark:bg-gray-700' : 'bg-white dark:bg-gray-800'}`;
            commentDiv.dataset.commentId = comment.id;
            let starsHTML = '';
            if (comment.rating) { 
                for (let i = 1; i <= 5; i++) starsHTML += `<i class="fas fa-star ${i <= comment.rating ? 'text-yellow-500' : 'text-gray-300 dark:text-gray-600'}"></i>`;
            }

            commentDiv.innerHTML = `
                <div class="flex items-start justify-between mb-1">
                    <div>
                        <p class="font-bold text-gray-900 dark:text-yellow-400">${comment.name}</p>
                        <p class="text-xs text-gray-500 dark:text-gray-400">${new Date(comment.timestamp).toLocaleString('ar-SA', { year: 'numeric', month: 'short', day: 'numeric', hour: '2-digit', minute:'2-digit' })}</p>
                    </div>
                    ${comment.rating ? `<div class="flex mb-2 text-sm">${starsHTML}</div>` : ''}
                </div>
                <p class="text-gray-700 dark:text-gray-300 whitespace-pre-wrap mb-2">${comment.text}</p>
                 <div class="flex items-center space-x-3 space-x-reverse text-sm">
                    <button class="comment-like-btn text-gray-600 dark:text-gray-400 hover:text-yellow-500 dark:hover:text-yellow-400" data-comment-id="${comment.id}" aria-label="إعجاب بالشهادة">
                        <i class="fas fa-thumbs-up ${comment.userLiked ? 'text-yellow-500 dark:text-yellow-400' : ''}"></i> <span class="comment-like-count">${comment.likes}</span>
                    </button>
                    ${!isReply ? `<button class="comment-reply-btn text-gray-600 dark:text-gray-400 hover:text-yellow-500 dark:hover:text-yellow-400" data-comment-id="${comment.id}" aria-label="الرد على الشهادة">
                        <i class="fas fa-reply"></i> رد
                    </button>` : ''}
                </div>`;
            return commentDiv;
        }

        if (commentForm) {
            commentForm.addEventListener('submit', function(event) {
                event.preventDefault();
                const name = document.getElementById('commentName').value.trim();
                const email = document.getElementById('commentEmail').value.trim(); 
                const rating = parseInt(ratingValueInput.value);
                const text = document.getElementById('commentText').value.trim();
                const replyToId = replyToCommentIdInput.value;

                if (!name || !ratingValueInput.value || !text) { 
                    Swal.fire({ icon: 'error', title: 'خطأ', text: 'يرجى كتابة الاسم، تقييم الخدمة، ونص التعليق.', confirmButtonColor: 'var(--primary-color)' });
                    return;
                }
                
                Swal.fire({
                    title: "جاري إرسال التعليق...",
                    timer: 2000, 
                    timerProgressBar: true,
                    didOpen: () => { Swal.showLoading(); },
                    showConfirmButton: false, allowOutsideClick: false, allowEscapeKey: false
                });

                setTimeout(() => {
                    const newComment = {
                        id: 'comment' + Date.now(), name, email: email || null, rating: parseInt(rating), text,
                        likes: 0, userLiked: false, replies: [], timestamp: new Date().toISOString()
                    };
                    
                    // Ensure comments is an array before pushing
                    if (!Array.isArray(comments)) {
                        comments = [];
                    }

                    if (replyToId) {
                        const parentComment = findCommentById(comments, replyToId);
                        if (parentComment) {
                            if (!parentComment.replies) parentComment.replies = [];
                            parentComment.replies.push(newComment);
                        } else { comments.push(newComment); } 
                        replyToCommentIdInput.value = ''; 
                        document.getElementById('commentText').value = ''; 
                    } else {
                        comments.push(newComment);
                    }
                    
                    saveToLocalStorage('altoukhy_comments_spiritual', comments);
                    renderComments(); 
                    commentForm.reset();
                    const stars = ratingStarsContainer.querySelectorAll('.rating-star');
                    stars.forEach(s => {
                        s.classList.remove('selected');
                        s.style.color = (htmlElement.classList.contains('dark') ? '#4b5563' : '#d1d5db');
                    });
                    ratingValueInput.value = '';
                }, 500); 
            });
        }

        function findCommentById(commentsArray, id) {
            if (!Array.isArray(commentsArray)) return null;
            for (let comment of commentsArray) {
                if (comment.id === id) return comment;
                if (comment.replies && comment.replies.length > 0) {
                    const foundInReply = findCommentById(comment.replies, id);
                    if (foundInReply) return foundInReply;
                }
            }
            return null;
        }

        function handleCommentLike(event) {
            const button = event.currentTarget; const commentId = button.dataset.commentId;
            const comment = findCommentById(comments, commentId);
            if (comment) {
                comment.userLiked ? comment.likes-- : comment.likes++;
                comment.userLiked = !comment.userLiked;
                button.querySelector('i').classList.toggle('text-yellow-500', comment.userLiked);
                button.querySelector('i').classList.toggle('dark:text-yellow-400', comment.userLiked);
                button.querySelector('.comment-like-count').textContent = comment.likes;
                saveToLocalStorage('altoukhy_comments_spiritual', comments);
            }
        }

        function handleCommentReplySetup(event) {
            const commentId = event.currentTarget.dataset.commentId;
            const parentComment = findCommentById(comments, commentId);
            replyToCommentIdInput.value = commentId;
            if (parentComment) {
                 document.getElementById('commentText').value = `@${parentComment.name} `;
            }
            commentForm.scrollIntoView({ behavior: 'smooth', block: 'center' });
            document.getElementById('commentText').focus();
        }

        // --- Footer Buttons ---
        const goToTopButton = document.getElementById('goToTop');
        const goToCommentsButton = document.getElementById('goToComments');
        const currentYearSpan = document.getElementById('currentYear');

        if (goToTopButton) goToTopButton.addEventListener('click', () => window.scrollTo({ top: 0, behavior: 'smooth' }));
        if (goToCommentsButton) goToCommentsButton.addEventListener('click', () => document.getElementById('comments-section').scrollIntoView({ behavior: 'smooth' }));
        if (currentYearSpan) currentYearSpan.textContent = new Date().getFullYear();

        // --- Initial Load ---
        document.addEventListener('DOMContentLoaded', () => {
            updateAllWhatsappLinks(); 
            initializeProductInteractions(); 
            renderProducts(); 
            initializeDefaultComments(); 
            renderComments();
            typeText(); 
        });
    </script>
</body>
</html>
